#!/bin/bash

set -x

REMOTE_ADDR=192.168.11.106

while getopts ":i:s:" opt; do
    case $opt in
    i)
        REMOTE_ADDR=$OPTARG
        ;;
    s)
        SESSION=$OPTARG
        ;;
    \?)
        echo "Invalid option: -$OPTARG" >&2
        exit 1
        ;;
    :)
        echo "Option -$OPTARG requires an argument." >&2
        exit 1
        ;;
    esac
done

shift $((OPTIND-1))

# Environment variables to set before running Koha scripts or pages
#  from the command line

KOHA_CONF="${KOHA_CONF:-$HOME/koha-dev/etc/koha-conf.xml}"
PERL5LIB="${PERL5LIB:-$HOME/kohaclone}"

export KOHA_CONF
export PERL5LIB
export HTTP_COOKIE="CGISESSID=$SESSION"
export REMOTE_ADDR

# TODO see http://stackoverflow.com/a/2224748/266747
# for other CGI environment variables -- in particular,
# we need to be able to handle REQUEST_METHOD=POST
# and figure out how to re-direct STDIN to the exec.

# Next, run the script
exec "$@"
